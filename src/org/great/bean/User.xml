<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" 
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="org.great.mapper.UserMapper">
	
<!-- 查询雇主信息 -->
<select id="employer" resultType="org.great.bean.UserBean">
select * from usertbl where userid = #{userid}
</select>

<select id="serachEmployer" resultType="org.great.bean.UserBean">
select * from(select t.*,rownum rn from(select * from usertbl where characterid='1' and username like #{name})t where rownum &lt;= #{end}) where rn &gt;= #{start}
</select>
<select id="employerNumber" resultType="org.great.bean.UserBean">
select * from usertbl where characterid='1' and username like #{name}
</select>
<select id="serachBusiness" resultType="org.great.bean.UserBean" >
select * from(select t.*,rownum rn from(select * from usertbl where characterid='2' and username like #{name})t where rownum &lt;= #{end}) where rn &gt;= #{start}
</select>
<select id="businessNumber" resultType="org.great.bean.UserBean">
select * from usertbl where characterid='2' and username like #{name}
</select>
<select id="login"  parameterType="String" resultType="org.great.bean.UserBean" >
	 	select characterTbl.characterName,stateTbl.stateName,userTbl.* from userTbl,characterTbl,stateTbl where userAccount=#{0} and userPwd=#{1} and userTbl.stateId=stateTbl.stateId and userTbl.characterId=characterTbl.characterId  
 </select>
 <insert id="addUser" >
 	insert into userTbl(userId,userAccount,userPwd,characterId,userName,userTel,userIdentity,stateId,userRegisterTime,userMoney) values (SEQID.nextval,#{userAccount},#{userPwd},#{characterId},#{userName},#{userTel},#{userIdentity},#{stateId},#{userRegisterTime},0)
 </insert> 
 <select id="checkAccount" parameterType="String" resultType="org.great.bean.UserBean">
         select * from userTbl where userAccount=#{userAccount}
 </select>

<!-- 个人中心 -->
<select id="userinfo" resultMap="getUserInfo">
select * from usertbl where userid = #{userid}
</select>
<select id="getStateName" parameterType="org.great.bean.UserInfoBean" resultType="org.great.bean.StateBean">
select * from statetbl where stateid=#{stateid}
</select>
<select id="getCharacter" parameterType="org.great.bean.UserInfoBean" resultType="org.great.bean.CharacteBean">
select * from charactertbl where characterid = #{characterid}
</select>

<resultMap type="org.great.bean.UserInfoBean" id="getUserInfo">

<association property="stateBean" column="stateid" javaType="org.great.bean.StateBean" select="getStateName">
</association>

<association property="characteBean" column="characterid" javaType="org.great.bean.CharacteBean" select="getCharacter">
</association>
</resultMap>	
 
<!-- 查询所有雇主 -->
<select id="employers" resultType="org.great.bean.UserBean">
select * from (
select c.*,rownum rn from (
select u.*,c.charactername from usertbl u,characterTbl c where  u.CharacterId=c.CharacterId 
<if test="name != null and name==''">
and u.username like #{name}
</if> 

 ) c 
 where rownum &lt;= (#{page}*5))
 where rn &gt;= ((#{page}-1)*5) order by rn 
</select>

<select id="facilitator" resultType="org.great.bean.UserBean">
select * from (
select c.*,rownum rn from (
select u.*,c.charactername,s.stateName from usertbl u,characterTbl c,stateTbl s where  u.CharacterId=c.CharacterId and u.CharacterId=2 and u.stateId=s.stateId and u.stateId!=3
<if test="name!= null ">
and u.username like #{name}
</if>
 ) c 
 where rownum &lt;= (#{page}*5))
 where rn &gt;= ((#{page}-1)*5+1) 
</select>






<!-- 删除雇主 -->
<update id="delEmployers" parameterType="java.lang.String">
UPDATE usertbl set stateid=3 WHERE useraccount=#{account}
</update>

<!-- 查询雇主总个数 -->
<select id="countEmployers" resultType="java.lang.Integer">
select count(*) from usertbl 
</select> 
<select id="countFacilitator" resultType="org.great.bean.UserBean">
select * from usertbl where characterId=2 and stateId=1

</select>
<select id="countFacilitator2"  resultType="org.great.bean.UserBean">
select * from usertbl where characterId=2 and stateId=2

</select>  
<select id="countFacilitator3" parameterType="String" resultType="org.great.bean.UserBean">
select * from usertbl where characterId=2 and stateId=1 and userName like #{userName}

</select>
<select id="countFacilitator4" parameterType="String" resultType="org.great.bean.UserBean">
select * from usertbl where characterId=2 and stateId=2 and userName like #{userName}

</select> 
<update id="changeState" parameterType="java.lang.Integer">
UPDATE usertbl set stateid=2 WHERE userId=#{userId}
</update>
<update id="changeState2" parameterType="java.lang.Integer">
UPDATE usertbl set stateid=1 WHERE userId=#{userId}
</update>
<update id="changeState3" parameterType="java.lang.Integer">
UPDATE usertbl set stateid=3 WHERE userId=#{userId}
</update>
<update id="changeInfo" >
UPDATE usertbl set userName=#{userName},userTel=#{userTel},userAccount=#{userAccount},userSex=#{userSex},userMail=#{userMail},userIdentity=#{userIdentity},userCredit=#{userCredit},userMoney=#{userMoney},userRegisterTime=#{userRegisterTime} WHERE userId=#{userId}
</update>

</mapper>

